# NeON Build File (http://github.com/c4s4/neon)

properties:
  DOTENV_PATTERN: '^(local|stg|prd])$'
  DOTENV_DEFAULT: 'local'

targets:

  dotenv-link:
    doc: Link dotenv file for platform
    steps:
    - if: '!defined("DOTENV_PF")'
      then:
      - prompt:  'Enter env'
        default: =DOTENV_DEFAULT
        pattern: =DOTENV_PATTERN
        to:      DOTENV_PF
    - delete: '.env'
    - link: '.env.={DOTENV_PF}'
      to:   '.env'

  _dotenv-prompt:
    doc: Prompt for env and key
    steps:
    - prompt:  'Enter env'
      default: =DOTENV_DEFAULT
      pattern: =DOTENV_PATTERN
      to:      env
    - prompt: 'Enter key'
      to:     key

  dotenv-decrypt:
    doc: Decrypt environment file
    steps:
    - call: _dotenv-prompt
    - $: ['openssl', 'aes-256-cbc', '-d', '-in', '.env.={env}.enc', '-k', =key]
      1>: '.env.={env}'
      1x: true

  dotenv-encrypt:
    doc: Encrypt environment file
    steps:
    - call: _dotenv-prompt
    - $: ['openssl', 'aes-256-cbc', '-e', '-in', '.env.={env}', '-k', =key]
      1>: '.env.={env}.enc'
      1x: true
